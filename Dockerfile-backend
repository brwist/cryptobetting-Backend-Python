FROM python:3.8

WORKDIR /usr/src/backend

COPY ./ ./

# cron configuration 
RUN apt update && apt install -y cron
RUN crontab crontab-backend

# RUN apt update && apt install -y cron
# COPY crontab-backend /etc/cron.d/example-crontab
# RUN chmod 0644 /etc/cron.d/example-crontab
# RUN crontab /etc/cron.d/example-crontab

#RUN apt install python3-testresources
RUN pip install wheel

RUN pip install --no-cache-dir -r requirements.txt

RUN pip install supervisor
RUN supervisord -c supervisord.conf
RUN pip install gunicorn

CMD gunicorn -w 3 -t 2 -b 0.0.0.0:$BACKEND_PORT --timeout 15000 --max-requests 1000 app:app
# ENTRYPOINT ["bash", "init.sh"]